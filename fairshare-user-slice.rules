// Allow users to manage their own user-<UID>.slice resource limits
// This policy enables fairshare to work without sudo for regular users

polkit.addRule(function(action, subject) {
    // Allow systemctl set-property and revert on user's own slice
    if ((action.id == "org.freedesktop.systemd1.manage-unit-files" ||
         action.id == "org.freedesktop.systemd1.manage-units") &&
        subject.isInGroup("users")) {

        // Extract the unit name from the action
        var unit = action.lookup("unit");

        // Check if it's the user's own slice
        if (unit && unit.match("^user-" + subject.user + "\\.slice$")) {
            return polkit.Result.YES;
        }
    }

    return polkit.Result.NOT_HANDLED;
});
